# ========================================
# 合约价格异动监控系统配置
# ========================================

# 按 24h 成交额分层阈值配置
# 从高到低排列，匹配第一个满足条件的层级
volume_tiers:
  # 超大盘：24h成交额 >= 10亿U
  - min_quote_volume: 1000000000
    price_threshold: 1.5      # 价格变化 1.5% 触发
    volume_threshold: 3.0     # 成交量 3 倍于均值触发
    oi_threshold: 5.0         # 持仓量变化 5% 触发
    spread_threshold: 1.0    # 现货-合约价差 1% 触发
    label: "超大盘"

  # 大盘：24h成交额 >= 1亿U
  - min_quote_volume: 100000000
    price_threshold: 2.5      # 价格变化 2.5% 触发
    volume_threshold: 4.0     # 成交量 4 倍于均值触发
    oi_threshold: 8.0         # 持仓量变化 8% 触发
    spread_threshold: 2.0    # 现货-合约价差 2% 触发
    label: "大盘"

  # 中盘：24h成交额 >= 1000万U
  - min_quote_volume: 10000000
    price_threshold: 4.0      # 价格变化 4% 触发
    volume_threshold: 5.0     # 成交量 5 倍于均值触发
    oi_threshold: 10.0        # 持仓量变化 10% 触发
    spread_threshold: 5.0     # 现货-合约价差 5% 触发
    label: "中盘"

  # 小盘：24h成交额 < 1000万U
  - min_quote_volume: 0
    price_threshold: 6.0      # 价格变化 6% 触发
    volume_threshold: 6.0     # 成交量 6 倍于均值触发
    oi_threshold: 15.0        # 持仓量变化 15% 触发
    spread_threshold: 10.0     # 现货-合约价差 10% 触发
    label: "小盘"

# 告警配置
alerts:
  # 价格异动告警
  price_change:
    enabled: true
    time_window: 60           # 检测窗口（秒）

  # 成交量突增告警
  volume_spike:
    enabled: true
    lookback_periods: 10      # 对比最近 N 个周期的平均成交量

  # 持仓量变化告警
  open_interest:
    enabled: false
    poll_interval: 30         # 轮询间隔（秒）
    time_window: 300          # 检测窗口（秒）

  # 现货-合约价差告警
  spot_futures_spread:
    enabled: false
    threshold: 3.0            # 价差阈值（%），现货价格相对合约价格的差异
    time_window: 60           # 检测窗口（秒）
    poll_interval: 30         # 现货价格轮询间隔（秒）

  # 价格反转告警
  price_reversal:
    enabled: true
    time_window: 300          # 检测窗口（秒），默认5分钟

  # 订单簿异动告警
  orderbook:
    enabled: false
    # 监控的交易对（留空则使用全局配置）
    symbols: []
    # 大单墙检测
    wall_detection: true
    wall_value_threshold: 500000    # 大单墙最小价值阈值(USDT)
    wall_ratio_threshold: 3.0       # 单档挂单量 > 平均值 N 倍
    wall_distance_max: 2.0          # 距离当前价格最大百分比
    # 深度失衡检测
    imbalance_detection: true
    imbalance_threshold: 0.6        # 失衡比率阈值 (0-1)，0.6表示60%
    imbalance_depth_levels: 10      # 计算失衡的档位数
    # 扫盘检测（大单墙被吃）
    sweep_detection: true
    sweep_value_threshold: 300000   # 被吃掉的最小价值(USDT)
    # 订单簿更新速度
    update_speed: "500ms"           # "100ms" 或 "500ms"
    depth_levels: 20                # 订阅档位数 5/10/20

  # 告警冷却时间（秒）- 同一币种同类型告警的最小间隔
  cooldown: 300

# 币种过滤
filter:
  # 模式: "all" | "whitelist" | "blacklist"
  mode: "all"

  # 白名单模式下，仅监控这些币种
  whitelist:
    - BTCUSDT
    - ETHUSDT
    - BNBUSDT
    - SOLUSDT
    - XRPUSDT

  # 黑名单模式下，排除这些币种
  blacklist:
    - USDCUSDT
    - TUSDUSDT
    - BUSDUSDT
    - FDUSDUSDT

# Telegram 配置（敏感信息通过环境变量设置）
telegram:
  enabled: true

# 日志配置
logging:
  level: "INFO"               # DEBUG | INFO | WARNING | ERROR
  file_output: true
  file_path: "logs/monitor.log"

# ========================================
# ML量化模块配置
# ========================================
ml:
  # 是否启用ML模块
  enabled: false

  # SQLite数据库路径
  db_path: "data/ml_data.db"

  # 特征计算配置
  feature:
    # 特征时间窗口（秒）
    windows: [60, 300, 900, 1800]
    # 特征保存间隔（秒）
    save_interval: 1

  # 标签生成配置
  label:
    # 标签时间窗口（秒）
    windows: [60, 300, 900, 1800]
    # 方向标签阈值（%），超过此值才判定为涨/跌
    direction_threshold: 0.1

  # 技术指标配置
  indicators:
    # 移动平均周期
    ma_periods: [5, 20, 60]
    # RSI周期
    rsi_period: 14
    # MACD参数
    macd_fast: 12
    macd_slow: 26
    macd_signal: 9
    # 布林带参数
    bb_period: 20
    bb_std: 2.0

  # 风险过滤配置
  risk:
    # 是否启用风险过滤
    enabled: true
    # 检测到假异动时是否过滤告警推送
    filter_alerts: true
    # 最大WebSocket延迟（毫秒）
    max_ws_latency_ms: 500
    # 最大价差（基点）
    max_spread_bps: 50
    # 最小深度价值（USDT）
    min_depth_value: 50000
    # 假异动检测窗口（秒）
    fake_signal_window: 30
    # 假异动反转比例阈值（回撤/涨幅 > 80%）
    fake_signal_revert_ratio: 0.8
    # 假异动最小变化幅度（%）
    fake_signal_min_change: 1.0

# ========================================
# 模拟交易模块配置
# ========================================
trading:
  # 是否启用模拟交易
  enabled: false

  # 运行模式: "backtest" | "realtime" | "both"
  mode: "realtime"

  # 账户配置
  account:
    # 初始资金(USDT)
    initial_balance: 10000
    # 固定杠杆倍数
    leverage: 15
    # 挂单手续费(0.02%)
    maker_fee: 0.0002
    # 吃单手续费(0.05%)
    taker_fee: 0.0005
    # 最大同时持仓数
    max_positions: 5
    # 单笔风险占权益百分比
    position_risk_pct: 2.0

  # 策略配置
  strategy:
    # 最小信号置信度 (0-1)
    min_confidence: 0.5
    # 信号分数阈值
    signal_threshold: 0.4
    # 是否使用ML模型（暂用规则策略）
    use_ml_model: true
    # 是否启用技术指标过滤
    indicator_filter: true
    # RSI超卖阈值（低于此值考虑做多）
    rsi_oversold: 30
    # RSI超买阈值（高于此值考虑做空）
    rsi_overbought: 70
    # 最小波动率(%)，波动太小不开仓
    min_volatility: 0.3
    # 最小成交量倍数，量能不足不开仓
    min_volume_ratio: 0.5
    # 订单簿买盘强阈值
    imbalance_long_threshold: 0.65
    # 订单簿卖盘强阈值
    imbalance_short_threshold: 0.35
    # 趋势一致性过滤阈值(%)
    trend_filter_pct: 1.0

  # 止损配置
  stop_loss:
    # 止损方法: "fixed" | "atr" | "trailing" | "multiple"
    # multiple = 综合使用多种止损方式
    method: "multiple"
    # 固定止损百分比
    fixed_stop_pct: 1.5
    # 固定止盈百分比
    take_profit_pct: 3.0
    # ATR止损倍数
    atr_multiplier: 2.0
    # ATR计算周期
    atr_period: 14
    # 移动止损距离(%)
    trailing_distance: 1.0
    # 激活移动止损的盈利阈值(%)
    trailing_activation: 1.0
    # 最大持仓时间（秒），默认15分钟
    max_hold_seconds: 900

  # 回测配置
  backtest:
    # 回测开始日期
    start_date: "2024-01-01"
    # 回测结束日期
    end_date: "2024-12-31"
    # 回测币种列表，空列表表示全部
    symbols: []
    # 是否保存交易记录到数据库
    save_trades: true

  # 实时模拟配置
  realtime:
    # 是否启用实时模拟
    enabled: false
    # 账户状态保存间隔（秒）
    save_interval: 60
    # 是否记录交易日志
    log_trades: true
    # 每个交易对最大持仓数
    max_positions_per_symbol: 1
    # 允许交易的币种，空列表表示全部
    allowed_symbols: []
